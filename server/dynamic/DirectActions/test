#!/system/bin/sh

life_path="/sys/block/mmcblk0/device/life_time"
eol_path="/sys/block/mmcblk0/device/pre_eol_info"

life=$(cat "$life_path" 2>/dev/null)
eol=$(cat "$eol_path" 2>/dev/null)

life1=$(echo "$life" | awk '{print $1}')
life2=$(echo "$life" | awk '{print $2}')

[ -z "$life1" ] && life1="00"
[ -z "$life2" ] && life2="00"
[ -z "$eol" ] && eol="00"

slc=$(printf "%d" 0x$life1)
mlc=$(printf "%d" 0x$life2)
eol_d=$(printf "%d" 0x$eol)

life1_fmt=$(printf "0x%02X" 0x$life1)
life2_fmt=$(printf "0x%02X" 0x$life2)
eol_fmt=$(printf "0x%02X" 0x$eol)

echo "============================="
echo " üìä eMMC Health Monitor"
echo "============================="
echo "üì¶ SLC Life Used : $slc ($life1_fmt)"
echo "üì¶ MLC Life Used : $mlc ($life2_fmt)"

if [ "$slc" -lt 5 ] && [ "$mlc" -lt 5 ]; then
  echo "‚úÖ Life Status    : Excellent"
elif [ "$slc" -lt 10 ] && [ "$mlc" -lt 10 ]; then
  echo "üü° Life Status    : Moderate Usage"
elif [ "$slc" -lt 12 ] && [ "$mlc" -lt 12 ]; then
  echo "‚ö†Ô∏è  Life Status    : High Wear (80-90%)"
else
  echo "‚ùå Life Status    : Near Failure (>90%)"
fi

case "$eol_d" in
  1) echo "‚è≥ Pre-EOL Info   : 01 (Normal)
‚úÖ eMMC Status    : Currently working normal" ;;
  2) echo "‚è≥ Pre-EOL Info   : 02 (Warning)
‚ö†Ô∏è  eMMC Status    : Warning, nearing end-of-life" ;;
  3) echo "‚è≥ Pre-EOL Info   : 03 (Critical)
‚ùå eMMC Status    : Critical, failure imminent" ;;
  *) echo "‚è≥ Pre-EOL Info   : Unknown (Raw: $eol_fmt | Dec: $eol_d)
‚ùì eMMC Status    : Unable to interpret pre-eol value" ;;
esac

echo "============================="
echo "Feature is provided by Araaf Royall"