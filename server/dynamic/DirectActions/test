#!/system/bin/sh

life_path="/sys/block/mmcblk0/device/life_time"
eol_path="/sys/block/mmcblk0/device/pre_eol_info"

life=$(cat "$life_path" 2>/dev/null)
eol=$(cat "$eol_path" 2>/dev/null)

slc=$(printf "%d" 0x$(echo "$life" | awk '{print $1}'))
mlc=$(printf "%d" 0x$(echo "$life" | awk '{print $2}'))
eol_d=$(printf "%d" 0x$eol)

echo "============================="
echo " üìä eMMC Health Monitor"
echo "============================="
echo "üì¶ SLC Life Used : $slc (0x$(echo "$life" | awk '{print $1}'))"
echo "üì¶ MLC Life Used : $mlc (0x$(echo "$life" | awk '{print $2}'))"

[ "$slc" -lt 5 ] && [ "$mlc" -lt 5 ] && echo "‚úÖ Life Status    : Excellent" ||
[ "$slc" -lt 10 ] && [ "$mlc" -lt 10 ] && echo "üü° Life Status    : Moderate Usage" ||
[ "$slc" -lt 12 ] && [ "$mlc" -lt 12 ] && echo "‚ö†Ô∏è  Life Status    : High Wear (80-90%)" ||
echo "‚ùå Life Status    : Near Failure (>90%)"

case "$eol_d" in
  1) echo "‚è≥ Pre-EOL Info   : 01 (Normal)
‚úÖ eMMC Status    : Currently working normal" ;;
  2) echo "‚è≥ Pre-EOL Info   : 02 (Warning)
‚ö†Ô∏è  eMMC Status    : Warning, nearing end-of-life" ;;
  3) echo "‚è≥ Pre-EOL Info   : 03 (Critical)
‚ùå eMMC Status    : Critical, failure imminent" ;;
  *)
    echo "‚è≥ Pre-EOL Info   : Unknown (Raw: 0x$eol | Dec: $eol_d)"
    echo "‚ùì eMMC Status    : Unable to interpret pre-eol value"
    ;;
esac

echo "============================="
echo "Feature is provided by Araaf Royall"